let sql;
const sqlite = require('sqlite3').verbose();
const db = new sqlite.Database('src/db/kha.db', sqlite.OPEN_READWRITE, (err) => {
  if (err) {
    throw new Error(err.message);
  }
  console.log('Connected to the database.');
});

async function load() {
  console.log('Fetching data from the database...');
  return new Promise((resolve, reject) => {
    sql = `SELECT * FROM oradorespublicosforaneos`;
    db.all(sql, [], (err, rows) => {
      if (err) {
        console.error('Error fetching data:', err.message);
        reject(err);
      } else {
        console.log('Data fetched:', rows);
        resolve(rows);
      }
    });
  });
}

function loadById(id) {
  console.log(`Fetching data for ID ${id} from the database...`);
  return new Promise((resolve, reject) => {
    const sql = 'SELECT * FROM oradorespublicosforaneos WHERE id = ?';
    db.get(sql, [id], (err, row) => {
      if (err) {
        console.error('Error fetching data:', err.message);
        reject(err);
      } else {
        console.log('Data fetched:', row);
        resolve(row);
      }
    });
  });
}

async function save(form) {
  console.log('Saving data to the database:', form);
  const {
    id,
    nombre,
    apellidos,
    aprobado,
    correoElectronico,
    celular,
    telefono,
    nombramiento,
    discurso1,
discurso2,
discurso3,
discurso4,
discurso5,
discurso6,
discurso7,
discurso8,
discurso9,
discurso10,
discurso11,
discurso12,
discurso13,
discurso14,
discurso15,
discurso16,
discurso17,
discurso18,
discurso19,
discurso20,
discurso21,
discurso22,
discurso23,
discurso24,
discurso25,
discurso26,
discurso27,
discurso28,
discurso29,
discurso30,
discurso31,
discurso32,
discurso33,
discurso34,
discurso35,
discurso36,
discurso37,
discurso38,
discurso39,
discurso40,
discurso41,
discurso42,
discurso43,
discurso44,
discurso45,
discurso46,
discurso47,
discurso48,
discurso49,
discurso50,
discurso51,
discurso52,
discurso53,
discurso54,
discurso55,
discurso56,
discurso57,
discurso58,
discurso59,
discurso60,
discurso61,
discurso62,
discurso63,
discurso64,
discurso65,
discurso66,
discurso67,
discurso68,
discurso69,
discurso70,
discurso71,
discurso72,
discurso73,
discurso74,
discurso75,
discurso76,
discurso77,
discurso78,
discurso79,
discurso80,
discurso81,
discurso82,
discurso83,
discurso84,
discurso85,
discurso86,
discurso87,
discurso88,
discurso89,
discurso90,
discurso91,
discurso92,
discurso93,
discurso94,
discurso95,
discurso96,
discurso97,
discurso98,
discurso99,
discurso100,
discurso101,
discurso102,
discurso103,
discurso104,
discurso105,
discurso106,
discurso107,
discurso108,
discurso109,
discurso110,
discurso111,
discurso112,
discurso113,
discurso114,
discurso115,
discurso116,
discurso117,
discurso118,
discurso119,
discurso120,
discurso121,
discurso122,
discurso123,
discurso124,
discurso125,
discurso126,
discurso127,
discurso128,
discurso129,
discurso130,
discurso131,
discurso132,
discurso133,
discurso134,
discurso135,
discurso136,
discurso137,
discurso138,
discurso139,
discurso140,
discurso141,
discurso142,
discurso143,
discurso144,
discurso145,
discurso146,
discurso147,
discurso148,
discurso149,
discurso150,
discurso151,
discurso152,
discurso153,
discurso154,
discurso155,
discurso156,
discurso157,
discurso158,
discurso159,
discurso160,
discurso161,
discurso162,
discurso163,
discurso164,
discurso165,
discurso166,
discurso167,
discurso168,
discurso169,
discurso170,
discurso171,
discurso172,
discurso173,
discurso174,
discurso175,
discurso176,
discurso177,
discurso178,
discurso179,
discurso180,
discurso181,
discurso182,
discurso183,
discurso184,
discurso185,
discurso186,
discurso187,
discurso188,
discurso189,
discurso190,
discurso191,
discurso192,
discurso193,
discurso194,
  } = form;

  const existingData = await new Promise((resolve, reject) => {
    db.get('SELECT * FROM oradorespublicosforaneos WHERE id = ?', [id], (err, row) => {
      if (err) {
        reject(err);
      } else {
        resolve(row);
      }
    });
  });

  if (existingData) {
    const updateSql = `
      UPDATE oradorespublicosforaneos SET
      id = ?,
      nombre = ?,
      apellidos = ?,
      aprobado = ?,
      correoElectronico = ?,
      celular = ?,
      telefono = ?,
      nombramiento = ?,
      discurso1 = ?,
discurso2 = ?,
discurso3 = ?,
discurso4 = ?,
discurso5 = ?,
discurso6 = ?,
discurso7 = ?,
discurso8 = ?,
discurso9 = ?,
discurso10 = ?,
discurso11 = ?,
discurso12 = ?,
discurso13 = ?,
discurso14 = ?,
discurso15 = ?,
discurso16 = ?,
discurso17 = ?,
discurso18 = ?,
discurso19 = ?,
discurso20 = ?,
discurso21 = ?,
discurso22 = ?,
discurso23 = ?,
discurso24 = ?,
discurso25 = ?,
discurso26 = ?,
discurso27 = ?,
discurso28 = ?,
discurso29 = ?,
discurso30 = ?,
discurso31 = ?,
discurso32 = ?,
discurso33 = ?,
discurso34 = ?,
discurso35 = ?,
discurso36 = ?,
discurso37 = ?,
discurso38 = ?,
discurso39 = ?,
discurso40 = ?,
discurso41 = ?,
discurso42 = ?,
discurso43 = ?,
discurso44 = ?,
discurso45 = ?,
discurso46 = ?,
discurso47 = ?,
discurso48 = ?,
discurso49 = ?,
discurso50 = ?,
discurso51 = ?,
discurso52 = ?,
discurso53 = ?,
discurso54 = ?,
discurso55 = ?,
discurso56 = ?,
discurso57 = ?,
discurso58 = ?,
discurso59 = ?,
discurso60 = ?,
discurso61 = ?,
discurso62 = ?,
discurso63 = ?,
discurso64 = ?,
discurso65 = ?,
discurso66 = ?,
discurso67 = ?,
discurso68 = ?,
discurso69 = ?,
discurso70 = ?,
discurso71 = ?,
discurso72 = ?,
discurso73 = ?,
discurso74 = ?,
discurso75 = ?,
discurso76 = ?,
discurso77 = ?,
discurso78 = ?,
discurso79 = ?,
discurso80 = ?,
discurso81 = ?,
discurso82 = ?,
discurso83 = ?,
discurso84 = ?,
discurso85 = ?,
discurso86 = ?,
discurso87 = ?,
discurso88 = ?,
discurso89 = ?,
discurso90 = ?,
discurso91 = ?,
discurso92 = ?,
discurso93 = ?,
discurso94 = ?,
discurso95 = ?,
discurso96 = ?,
discurso97 = ?,
discurso98 = ?,
discurso99 = ?,
discurso100 = ?,
discurso101 = ?,
discurso102 = ?,
discurso103 = ?,
discurso104 = ?,
discurso105 = ?,
discurso106 = ?,
discurso107 = ?,
discurso108 = ?,
discurso109 = ?,
discurso110 = ?,
discurso111 = ?,
discurso112 = ?,
discurso113 = ?,
discurso114 = ?,
discurso115 = ?,
discurso116 = ?,
discurso117 = ?,
discurso118 = ?,
discurso119 = ?,
discurso120 = ?,
discurso121 = ?,
discurso122 = ?,
discurso123 = ?,
discurso124 = ?,
discurso125 = ?,
discurso126 = ?,
discurso127 = ?,
discurso128 = ?,
discurso129 = ?,
discurso130 = ?,
discurso131 = ?,
discurso132 = ?,
discurso133 = ?,
discurso134 = ?,
discurso135 = ?,
discurso136 = ?,
discurso137 = ?,
discurso138 = ?,
discurso139 = ?,
discurso140 = ?,
discurso141 = ?,
discurso142 = ?,
discurso143 = ?,
discurso144 = ?,
discurso145 = ?,
discurso146 = ?,
discurso147 = ?,
discurso148 = ?,
discurso149 = ?,
discurso150 = ?,
discurso151 = ?,
discurso152 = ?,
discurso153 = ?,
discurso154 = ?,
discurso155 = ?,
discurso156 = ?,
discurso157 = ?,
discurso158 = ?,
discurso159 = ?,
discurso160 = ?,
discurso161 = ?,
discurso162 = ?,
discurso163 = ?,
discurso164 = ?,
discurso165 = ?,
discurso166 = ?,
discurso167 = ?,
discurso168 = ?,
discurso169 = ?,
discurso170 = ?,
discurso171 = ?,
discurso172 = ?,
discurso173 = ?,
discurso174 = ?,
discurso175 = ?,
discurso176 = ?,
discurso177 = ?,
discurso178 = ?,
discurso179 = ?,
discurso180 = ?,
discurso181 = ?,
discurso182 = ?,
discurso183 = ?,
discurso184 = ?,
discurso185 = ?,
discurso186 = ?,
discurso187 = ?,
discurso188 = ?,
discurso189 = ?,
discurso190 = ?,
discurso191 = ?,
discurso192 = ?,
discurso193 = ?,
discurso194 = ?
      WHERE id = ?
    `;

    await db.serialize(async () => {
      await db.run('BEGIN TRANSACTION');
      await db.run(updateSql, [
        id,
        nombre,
        apellidos,
        aprobado,
        correoElectronico,
        celular,
        telefono,
        nombramiento,
        discurso1,
discurso2,
discurso3,
discurso4,
discurso5,
discurso6,
discurso7,
discurso8,
discurso9,
discurso10,
discurso11,
discurso12,
discurso13,
discurso14,
discurso15,
discurso16,
discurso17,
discurso18,
discurso19,
discurso20,
discurso21,
discurso22,
discurso23,
discurso24,
discurso25,
discurso26,
discurso27,
discurso28,
discurso29,
discurso30,
discurso31,
discurso32,
discurso33,
discurso34,
discurso35,
discurso36,
discurso37,
discurso38,
discurso39,
discurso40,
discurso41,
discurso42,
discurso43,
discurso44,
discurso45,
discurso46,
discurso47,
discurso48,
discurso49,
discurso50,
discurso51,
discurso52,
discurso53,
discurso54,
discurso55,
discurso56,
discurso57,
discurso58,
discurso59,
discurso60,
discurso61,
discurso62,
discurso63,
discurso64,
discurso65,
discurso66,
discurso67,
discurso68,
discurso69,
discurso70,
discurso71,
discurso72,
discurso73,
discurso74,
discurso75,
discurso76,
discurso77,
discurso78,
discurso79,
discurso80,
discurso81,
discurso82,
discurso83,
discurso84,
discurso85,
discurso86,
discurso87,
discurso88,
discurso89,
discurso90,
discurso91,
discurso92,
discurso93,
discurso94,
discurso95,
discurso96,
discurso97,
discurso98,
discurso99,
discurso100,
discurso101,
discurso102,
discurso103,
discurso104,
discurso105,
discurso106,
discurso107,
discurso108,
discurso109,
discurso110,
discurso111,
discurso112,
discurso113,
discurso114,
discurso115,
discurso116,
discurso117,
discurso118,
discurso119,
discurso120,
discurso121,
discurso122,
discurso123,
discurso124,
discurso125,
discurso126,
discurso127,
discurso128,
discurso129,
discurso130,
discurso131,
discurso132,
discurso133,
discurso134,
discurso135,
discurso136,
discurso137,
discurso138,
discurso139,
discurso140,
discurso141,
discurso142,
discurso143,
discurso144,
discurso145,
discurso146,
discurso147,
discurso148,
discurso149,
discurso150,
discurso151,
discurso152,
discurso153,
discurso154,
discurso155,
discurso156,
discurso157,
discurso158,
discurso159,
discurso160,
discurso161,
discurso162,
discurso163,
discurso164,
discurso165,
discurso166,
discurso167,
discurso168,
discurso169,
discurso170,
discurso171,
discurso172,
discurso173,
discurso174,
discurso175,
discurso176,
discurso177,
discurso178,
discurso179,
discurso180,
discurso181,
discurso182,
discurso183,
discurso184,
discurso185,
discurso186,
discurso187,
discurso188,
discurso189,
discurso190,
discurso191,
discurso192,
discurso193,
discurso194,
        id  // Add id here for the WHERE clause
      ], (_err) => {
        if (_err) {
          console.error('Error updating data:', _err.message);
          db.run('ROLLBACK');
        } else {
          console.log('Data updated successfully.');
          db.run('COMMIT');
        }
      });
    });
  } else {
    // Si no existe un registro existente, realiza una inserciÃ³n
    console.log('Inserting new data...');
    const insertSql = `
    INSERT INTO oradorespublicosforaneos
    (id, nombre, apellidos, aprobado, correoElectronico, celular, telefono, nombramiento,
     discurso1, discurso2, discurso3, discurso4, discurso5, discurso6, discurso7, discurso8,
     discurso9, discurso10, discurso11, discurso12, discurso13, discurso14, discurso15,
     discurso16, discurso17, discurso18, discurso19, discurso20, discurso21, discurso22,
     discurso23, discurso24, discurso25, discurso26, discurso27, discurso28, discurso29,
     discurso30, discurso31, discurso32, discurso33, discurso34, discurso35, discurso36,
     discurso37, discurso38, discurso39, discurso40, discurso41, discurso42, discurso43,
     discurso44, discurso45, discurso46, discurso47, discurso48, discurso49, discurso50,
     discurso51, discurso52, discurso53, discurso54, discurso55, discurso56, discurso57,
     discurso58, discurso59, discurso60, discurso61, discurso62, discurso63, discurso64,
     discurso65, discurso66, discurso67, discurso68, discurso69, discurso70, discurso71,
     discurso72, discurso73, discurso74, discurso75, discurso76, discurso77, discurso78,
     discurso79, discurso80, discurso81, discurso82, discurso83, discurso84, discurso85,
     discurso86, discurso87, discurso88, discurso89, discurso90, discurso91, discurso92,
     discurso93, discurso94, discurso95, discurso96, discurso97, discurso98, discurso99,
     discurso100, discurso101, discurso102, discurso103, discurso104, discurso105, discurso106,
     discurso107, discurso108, discurso109, discurso110, discurso111, discurso112, discurso113,
     discurso114, discurso115, discurso116, discurso117, discurso118, discurso119, discurso120,
     discurso121, discurso122, discurso123, discurso124, discurso125, discurso126, discurso127,
     discurso128, discurso129, discurso130, discurso131, discurso132, discurso133, discurso134,
     discurso135, discurso136, discurso137, discurso138, discurso139, discurso140, discurso141,
     discurso142, discurso143, discurso144, discurso145, discurso146, discurso147, discurso148,
     discurso149, discurso150, discurso151, discurso152, discurso153, discurso154, discurso155,
     discurso156, discurso157, discurso158, discurso159, discurso160, discurso161, discurso162,
     discurso163, discurso164, discurso165, discurso166, discurso167, discurso168, discurso169,
     discurso170, discurso171, discurso172, discurso173, discurso174, discurso175, discurso176,
     discurso177, discurso178, discurso179, discurso180, discurso181, discurso182, discurso183,
     discurso184, discurso185, discurso186, discurso187, discurso188, discurso189, discurso190,
     discurso191, discurso192, discurso193, discurso194)
VALUES (?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?,
      ?, ?, ?, ?, ?, ?, ?, ?)
    `;

    await db.serialize(async () => {
      await db.run('BEGIN TRANSACTION');
      await db.run(insertSql, [
        id,
        nombre,
        apellidos,
        aprobado,
        correoElectronico,
        celular,
        telefono,
        nombramiento,
        discurso1,
discurso2,
discurso3,
discurso4,
discurso5,
discurso6,
discurso7,
discurso8,
discurso9,
discurso10,
discurso11,
discurso12,
discurso13,
discurso14,
discurso15,
discurso16,
discurso17,
discurso18,
discurso19,
discurso20,
discurso21,
discurso22,
discurso23,
discurso24,
discurso25,
discurso26,
discurso27,
discurso28,
discurso29,
discurso30,
discurso31,
discurso32,
discurso33,
discurso34,
discurso35,
discurso36,
discurso37,
discurso38,
discurso39,
discurso40,
discurso41,
discurso42,
discurso43,
discurso44,
discurso45,
discurso46,
discurso47,
discurso48,
discurso49,
discurso50,
discurso51,
discurso52,
discurso53,
discurso54,
discurso55,
discurso56,
discurso57,
discurso58,
discurso59,
discurso60,
discurso61,
discurso62,
discurso63,
discurso64,
discurso65,
discurso66,
discurso67,
discurso68,
discurso69,
discurso70,
discurso71,
discurso72,
discurso73,
discurso74,
discurso75,
discurso76,
discurso77,
discurso78,
discurso79,
discurso80,
discurso81,
discurso82,
discurso83,
discurso84,
discurso85,
discurso86,
discurso87,
discurso88,
discurso89,
discurso90,
discurso91,
discurso92,
discurso93,
discurso94,
discurso95,
discurso96,
discurso97,
discurso98,
discurso99,
discurso100,
discurso101,
discurso102,
discurso103,
discurso104,
discurso105,
discurso106,
discurso107,
discurso108,
discurso109,
discurso110,
discurso111,
discurso112,
discurso113,
discurso114,
discurso115,
discurso116,
discurso117,
discurso118,
discurso119,
discurso120,
discurso121,
discurso122,
discurso123,
discurso124,
discurso125,
discurso126,
discurso127,
discurso128,
discurso129,
discurso130,
discurso131,
discurso132,
discurso133,
discurso134,
discurso135,
discurso136,
discurso137,
discurso138,
discurso139,
discurso140,
discurso141,
discurso142,
discurso143,
discurso144,
discurso145,
discurso146,
discurso147,
discurso148,
discurso149,
discurso150,
discurso151,
discurso152,
discurso153,
discurso154,
discurso155,
discurso156,
discurso157,
discurso158,
discurso159,
discurso160,
discurso161,
discurso162,
discurso163,
discurso164,
discurso165,
discurso166,
discurso167,
discurso168,
discurso169,
discurso170,
discurso171,
discurso172,
discurso173,
discurso174,
discurso175,
discurso176,
discurso177,
discurso178,
discurso179,
discurso180,
discurso181,
discurso182,
discurso183,
discurso184,
discurso185,
discurso186,
discurso187,
discurso188,
discurso189,
discurso190,
discurso191,
discurso192,
discurso193,
discurso194
      ], (_err) => {
        if (_err) {
          console.error('Error inserting data:', _err.message);
          db.run('ROLLBACK');
        } else {
          console.log('Data inserted successfully.');
          db.run('COMMIT');
        }
      });
    });
  }
}

async function eliminarOrador(id) {
  console.log(`Eliminando el orador con ID ${id}...`);
  const deleteSql = 'DELETE FROM oradorespublicosforaneos WHERE id = ?';

  return new Promise((resolve, reject) => {
    db.run(deleteSql, [id], (err) => {
      if (err) {
        console.error('Error al eliminar el orador:', err.message);
        reject(err);
      } else {
        console.log('Orador eliminado exitosamente.');
        resolve();
      }
    });
  });
}

export { load, loadById, save, eliminarOrador };